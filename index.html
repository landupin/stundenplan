<!DOCTYPE html>
<html lang="en">
<head>
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta charset="UTF-8">

    <title>Stundenplan</title>
    <link rel="icon" href="icon.png">
    <link rel="manifest" href="manifest.json">
</head>

<body>
<div class="container">
    <table>
        <thead>
        <th>Montag</th>
        <th>Dienstag</th>
        <th>Mittwoch</th>
        <th>Donnerstag</th>
        <th>Freitag</th>
        <th class="day-5">Samstag</th>
        </thead>
        <tbody id="app"></tbody>
    </table>
</div>

<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/materialize.min.js"></script>
<script>
    if ($.datepicker.iso8601Week( new Date() )%2) {var week = "a"}
    else {var week = "b"}

    $.getJSON("samstag.json", s => {
        if (!s[$.datepicker.iso8601Week( new Date() )-7]) {
            var samstag = false;
        }
    }).catch(() => M.toast({html: 'Failed to get JSON!'}));

    $.getJSON(week+"_stundenplan.json", c => {
        for (var d = 0; 4 > d; d++) {
            $("#app").append("<tr id='"+d+"'>");
            for (var e = 0; 6 > e; e++)
                if (!samstag && e === 6){break}
                if (c[e] && c[e][d]) {
                    var f = c[e][d].split("/", -1);
                    if (f.length > 2) { f[0] += " / "+f[2].toUpperCase(), f[1] += " / "+f[3], f = f.slice(0,2) }
                    f[0] = f[0].toUpperCase(), f[1] = "<p class='grey-text lighten-2'>" + f[1], f[1] += "</p>";

                    console.log(f);
                    $("#"+d).append("<td class='day-"+ e+"'>" + f.join(" ") + "</td>")
            } else $("#"+d).append("<td class='day-"+ e+"'></td>");
            $("#app").append("</tr>")
        }
    }).catch(() => M.toast({html: 'Failed to get JSON!'}));

    $.getJSON("samstag.json", s => {
        if (!s[$.datepicker.iso8601Week( new Date() )-7]) {
            $(".day-5").remove();
        }
    }).catch(() => M.toast({html: 'Failed to get JSON!'}));

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker
            .register('./sw.js')
            .then(function() { console.log('Service Worker Registered'); });
    }
</script>

</body>
</html>
